---
interface Props {
  pages: {
    [key: string]: {
      title: string;
      content: string;
      meta?: string; // New: optional meta info for projects
      isProject?: boolean; // New: flag to differentiate projects from utility pages
    };
  };
}

const { pages } = Astro.props;
const pageKeys = Object.keys(pages);

// Separate projects from utility pages
const projectKeys = pageKeys.filter(key => pages[key].isProject);
const utilityKeys = pageKeys.filter(key => !pages[key].isProject);
---

<div class="flex h-screen">
  <!-- Left sidebar -->
  <div class="sidebar">
    
    <!-- Header -->
    <div class="sidebar-header">
      <h1>Glen Meredith</h1>
      <p class="subtitle">UX Designer & Researcher</p>
    </div>

    <!-- Projects Section -->
    <div class="projects-section">
      {
        projectKeys.map((key, index) => (
          <button
            class="project-item"
            data-page={key}
            class:list={[{ active: index === 0 }]}
          >
            <div class="project-title">{pages[key].title}</div>
            {pages[key].meta && (
              <div class="project-meta">{pages[key].meta}</div>
            )}
          </button>
        ))
      }
    </div>

    <!-- Divider -->
    {utilityKeys.length > 0 && <div class="menu-divider"></div>}

    <!-- Utility Section -->
    {utilityKeys.length > 0 && (
      <div class="utility-section">
        {
          utilityKeys.map((key) => (
            <button
              class="utility-item"
              data-page={key}
            >
              {pages[key].title}
            </button>
          ))
        }
      </div>
    )}
  </div>

  <!-- Right content area -->
  <div class="flex-1 bg-white p-8 overflow-auto">
    <div id="content"></div>
  </div>
</div>

<script define:vars={{ pages }}>
  const projectItems = document.querySelectorAll(".project-item");
  const utilityItems = document.querySelectorAll(".utility-item");
  const allMenuItems = [...projectItems, ...utilityItems];
  const contentDiv = document.getElementById("content");
  
  // Select first PROJECT by default (not first page)
  const firstProjectKey = Object.keys(pages).find(key => pages[key].isProject);
  let selectedPage = firstProjectKey || Object.keys(pages)[0];

  // Scroll reveal observer
  let scrollObserver;
  function initNewScrollAnimations() {
    if (scrollObserver) scrollObserver.disconnect();

    const revealElements = document.querySelectorAll('.scroll-reveal');
    
    if (revealElements.length > 0) {
      scrollObserver = new IntersectionObserver(
        (entries) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              entry.target.classList.add('revealed');
            }
          });
        },
        {
          threshold: 0.1,
          rootMargin: '0px 0px -100px 0px'
        }
      );

      revealElements.forEach(el => scrollObserver.observe(el));
    }
  }

  // Helper to update content
  function updateContent(pageKey) {
    contentDiv.innerHTML = pages[pageKey].content;
    setTimeout(() => {
      initNewScrollAnimations();
    }, 0);
  }

  // Click handlers for all menu items
  allMenuItems.forEach((item) => {
    item.addEventListener("click", () => {
      // Remove active from all project items
      projectItems.forEach((m) => m.classList.remove("active"));
      
      // Add active only if it's a project item
      if (item.classList.contains("project-item")) {
        item.classList.add("active");
      }
      
      selectedPage = item.dataset.page;
      updateContent(selectedPage);
    });
  });

  // Show default page (first project)
  updateContent(selectedPage);
</script>

<style>
  /* Sidebar Base - TRUE DARK GRAY */
  .sidebar {
    width: 280px;
    background: #1a1a1a;
    color: white;
    display: flex;
    flex-direction: column;
    padding: 0;
  }

  /* Sidebar Header */
  .sidebar-header {
    padding: 32px 24px 24px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  }

  .sidebar-header h1 {
    font-family: 'Crimson Pro', serif;
    font-size: 28px;
    font-weight: 800;
    margin-bottom: 6px;
    letter-spacing: -0.02em;
  }

  .sidebar-header .subtitle {
    font-size: 15px;
    color: rgba(255, 255, 255, 0.6);
    font-weight: 400;
  }

  /* Projects Section */
  .projects-section {
    padding: 8px 0;
    flex: 1;
  }

  .project-item {
    width: 100%;
    text-align: left;
    padding: 18px 24px;
    border: none;
    background: transparent;
    border-left: 4px solid transparent;
    cursor: pointer;
    transition: all 0.2s ease;
    color: white;
  }

  .project-item:hover {
    background: rgba(255, 255, 255, 0.05);
    border-left-color: rgba(16, 185, 129, 0.4);
  }

  .project-item.active {
    background: rgba(16, 185, 129, 0.15);
    border-left-color: #10b981;
  }

  .project-title {
    font-family: 'Crimson Pro', serif;
    font-size: 18px;
    font-weight: 700;
    margin-bottom: 4px;
    letter-spacing: -0.01em;
    line-height: 1.3;
  }

  .project-meta {
    font-size: 13px;
    color: rgba(255, 255, 255, 0.5);
    font-weight: 400;
    line-height: 1.4;
  }

  /* Divider */
  .menu-divider {
    height: 1px;
    background: rgba(255, 255, 255, 0.1);
    margin: 12px 0;
  }

  /* Utility Section */
  .utility-section {
    padding: 8px 0 24px;
  }

  .utility-item {
    width: 100%;
    text-align: left;
    padding: 14px 24px;
    border: none;
    background: transparent;
    cursor: pointer;
    transition: all 0.2s ease;
    font-size: 15px;
    font-weight: 500;
    color: rgba(255, 255, 255, 0.7);
  }

  .utility-item:hover {
    background: rgba(255, 255, 255, 0.05);
    color: rgba(255, 255, 255, 0.9);
  }

  /* Content area transitions */
  #content {
    transition: opacity 0.15s ease-out;
  }

  #content.fade-out {
    opacity: 0;
  }
</style>